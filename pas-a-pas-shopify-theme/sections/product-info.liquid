{% comment %}
  产品详情区块 - 两栏布局
  包含尺码选择、Notify Me、数量选择、加购按钮
{% endcomment %}

{%- liquid
  assign current_variant = product.selected_or_first_available_variant
  assign enable_sticky_info = section.settings.enable_sticky_info
  assign enable_zoom = section.settings.enable_zoom
  assign show_size_guide = section.settings.show_size_guide
-%}

<section class="product-section" data-section-id="{{ section.id }}" data-section-type="product" data-product-handle="{{ product.handle }}">
  <div class="product-container">
    {% comment %} 左栏 - 图片 {% endcomment %}
    <div class="product-media">
      <div class="product-media-wrapper">
        {% if product.media.size > 0 %}
          <div class="product-main-media" data-product-media>
            {% for media in product.media limit: 1 %}
              <div class="media-item" data-media-id="{{ media.id }}">
                {% case media.media_type %}
                  {% when 'image' %}
                    {{ media | image_url: width: 1440 | image_tag:
                      loading: 'eager',
                      fetchpriority: 'high',
                      class: 'product-image',
                      alt: media.alt | escape
                    }}
                  {% when 'video' %}
                    {{ media | video_tag: controls: true, class: 'product-video' }}
                  {% else %}
                    {{ media | image_url: width: 1440 | image_tag:
                      loading: 'lazy',
                      class: 'product-image',
                      alt: media.alt | escape
                    }}
                {% endcase %}
              </div>
            {% endfor %}
          </div>
          
          {% comment %} 缩略图 {% endcomment %}
          {% if product.media.size > 1 %}
            <div class="product-thumbnails">
              {% for media in product.media %}
                <button 
                  type="button" 
                  class="thumbnail-item{% if forloop.first %} active{% endif %}"
                  data-thumbnail-id="{{ media.id }}"
                  aria-label="View image {{ forloop.index }}"
                >
                  {{ media | image_url: width: 200 | image_tag:
                    loading: 'lazy',
                    alt: media.alt | escape
                  }}
                </button>
              {% endfor %}
            </div>
          {% endif %}
        {% else %}
          {% comment %} 占位图 {% endcomment %}
          <div class="product-main-media">
            {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
          </div>
        {% endif %}
      </div>
    </div>

    {% comment %} 右栏 - 产品信息 {% endcomment %}
    <div class="product-info{% if enable_sticky_info %} sticky{% endif %}">
      <div class="product-info-inner">
        {% comment %} 产品名 {% endcomment %}
        <h1 class="product-title">{{ product.title | upcase }}</h1>

        {% comment %} 价格 {% endcomment %}
        <div class="product-price-wrapper">
          <span class="product-price" data-product-price>
            {{ current_variant.price | money_without_trailing_zeros }}
          </span>
          {% if current_variant.compare_at_price > current_variant.price %}
            <span class="product-compare-price">
              {{ current_variant.compare_at_price | money_without_trailing_zeros }}
            </span>
          {% endif %}
        </div>

        {% comment %} 描述 {% endcomment %}
        {% if product.description != blank %}
          <div class="product-description" data-description>
            <div class="description-content">{{ product.description }}</div>
            <button type="button" class="description-toggle" data-description-toggle>
              {{ 'products.product.read_more' | t }}
            </button>
          </div>
        {% endif %}

        {% comment %} 产品表单 {% endcomment %}
        {% form 'product', product, class: 'product-form', data-product-form: '' %}
          {% comment %} 变体选择器 {% endcomment %}
          {% unless product.has_only_default_variant %}
            <div class="product-variants">
              {% for option in product.options_with_values %}
                <div class="variant-option">
                  <label class="variant-label">{{ option.name | upcase }}</label>
                  
                  {% if option.name == 'Size' or option.name == 'サイズ' %}
                    {% comment %} 尺码选择器 - Button样式 {% endcomment %}
                    <div class="size-selector" data-option-name="{{ option.name }}">
                      {% for value in option.values %}
                        {% assign variant_available = true %}
                        {% for variant in product.variants %}
                          {% if variant.options[forloop.parentloop.index0] == value %}
                            {% unless variant.available %}
                              {% assign variant_available = false %}
                            {% endunless %}
                          {% endif %}
                        {% endfor %}
                        
                        <button 
                          type="button"
                          class="size-button{% unless variant_available %} sold-out{% endunless %}{% if option.selected_value == value %} selected{% endif %}"
                          data-value="{{ value | escape }}"
                          {% unless variant_available %}disabled{% endunless %}
                        >
                          {{ value | upcase }}
                          {% unless variant_available %}
                            <span class="sold-out-badge">{{ 'products.product.sold_out' | t }}</span>
                          {% endunless %}
                        </button>
                      {% endfor %}
                    </div>
                    
                    {% if show_size_guide %}
                      <button type="button" class="size-guide-link" data-size-guide-toggle>
                        {{ 'products.product.size_guide' | t }}
                      </button>
                    {% endif %}
                  {% else %}
                    {% comment %} 其他选项 - 下拉选择 {% endcomment %}
                    <select class="variant-select" name="options[{{ option.name }}]">
                      {% for value in option.values %}
                        <option 
                          value="{{ value | escape }}"
                          {% if option.selected_value == value %}selected{% endif %}
                        >
                          {{ value }}
                        </option>
                      {% endfor %}
                    </select>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          {% endunless %}

          {% comment %} 隐藏变体ID输入 {% endcomment %}
          <input type="hidden" name="id" value="{{ current_variant.id }}" data-variant-id>

          {% comment %} Notify Me - 缺货时显示 {% endcomment %}
          <div class="notify-me-wrapper{% if current_variant.available %} hidden{% endif %}" data-notify-me>
            <p class="notify-me-text">{{ 'products.product.notify_me_text' | t }}</p>
            <div class="notify-me-form">
              <input 
                type="email" 
                class="notify-me-input" 
                placeholder="{{ 'products.product.email_placeholder' | t }}"
                required
                data-notify-email
              >
              <button type="button" class="notify-me-button" data-notify-submit>
                {{ 'products.product.notify_me' | t }}
              </button>
            </div>
          </div>

          {% comment %} 数量选择器和加购按钮 {% endcomment %}
          <div class="product-actions{% unless current_variant.available %} hidden{% endunless %}" data-product-actions>
            {% comment %} 数量选择器 {% endcomment %}
            <div class="quantity-selector">
              <button type="button" class="quantity-button" data-quantity-minus aria-label="Decrease quantity">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M2 6h8"/>
                </svg>
              </button>
              <input 
                type="number" 
                name="quantity" 
                value="1" 
                min="1"
                class="quantity-input"
                data-quantity-input
              >
              <button type="button" class="quantity-button" data-quantity-plus aria-label="Increase quantity">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M6 2v8M2 6h8"/>
                </svg>
              </button>
            </div>

            {% comment %} 加购按钮 {% endcomment %}
            <button 
              type="submit" 
              name="add"
              class="add-to-cart-button"
              data-add-to-cart
              {% unless current_variant.available %}disabled{% endunless %}
            >
              <span class="button-text" data-button-text>
                {% if current_variant.available %}
                  {{ 'products.product.add_to_cart' | t }}
                {% else %}
                  {{ 'products.product.sold_out' | t }}
                {% endif %}
              </span>
              <span class="button-loader hidden" data-button-loader>
                <svg class="spinner" width="20" height="20" viewBox="0 0 20 20">
                  <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="31.416" stroke-dashoffset="10"/>
                </svg>
              </span>
            </button>
          </div>
        {% endform %}
      </div>
    </div>
  </div>
</section>

{% comment %} 尺码表弹窗 {% endcomment %}
{% if show_size_guide %}
  {% render 'size-guide' %}
{% endif %}

<style>
  .product-section {
    padding: 120px 40px;
    background: #000000;
    min-height: 100vh;
  }

  @media (max-width: 768px) {
    .product-section {
      padding: 100px 20px 60px;
    }
  }

  .product-container {
    display: grid;
    grid-template-columns: 6fr 4fr;
    gap: 60px;
    max-width: 1600px;
    margin: 0 auto;
  }

  @media (max-width: 1024px) {
    .product-container {
      grid-template-columns: 1fr 1fr;
      gap: 40px;
    }
  }

  @media (max-width: 768px) {
    .product-container {
      grid-template-columns: 1fr;
      gap: 40px;
    }
  }

  /* 图片区域 */
  .product-media-wrapper {
    position: sticky;
    top: 120px;
  }

  .product-main-media {
    aspect-ratio: 3/4;
    background: #111111;
    overflow: hidden;
  }

  .product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    cursor: zoom-in;
  }

  .product-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .placeholder-svg {
    width: 100%;
    height: 100%;
    fill: #333333;
  }

  /* 缩略图 */
  .product-thumbnails {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    overflow-x: auto;
    padding-bottom: 10px;
  }

  .thumbnail-item {
    flex-shrink: 0;
    width: 80px;
    height: 100px;
    background: #111111;
    border: 1px solid transparent;
    cursor: pointer;
    padding: 0;
    overflow: hidden;
    transition: border-color 0.3s ease;
  }

  .thumbnail-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .thumbnail-item.active,
  .thumbnail-item:hover {
    border-color: #FFFFFF;
  }

  /* 产品信息区域 */
  .product-info.sticky .product-info-inner {
    position: sticky;
    top: 120px;
  }

  .product-title {
    font-family: 'Inter', sans-serif;
    font-size: 32px;
    font-weight: 700;
    color: #FFFFFF;
    text-transform: uppercase;
    letter-spacing: 0.02em;
    margin: 0 0 16px;
    line-height: 1.2;
  }

  @media (max-width: 768px) {
    .product-title {
      font-size: 24px;
    }
  }

  /* 价格 */
  .product-price-wrapper {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
  }

  .product-price {
    font-family: 'Inter', sans-serif;
    font-size: 24px;
    font-weight: 300;
    color: #FFFFFF;
  }

  .product-compare-price {
    font-family: 'Inter', sans-serif;
    font-size: 18px;
    font-weight: 300;
    color: #888888;
    text-decoration: line-through;
  }

  /* 描述 */
  .product-description {
    margin-bottom: 32px;
  }

  .description-content {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    line-height: 1.8;
    color: #888888;
    display: -webkit-box;
    -webkit-line-clamp: 5;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .description-content.expanded {
    -webkit-line-clamp: unset;
  }

  .description-toggle {
    background: none;
    border: none;
    color: #FFFFFF;
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    cursor: pointer;
    padding: 8px 0;
    margin-top: 8px;
    text-decoration: underline;
  }

  /* 变体选择器 */
  .product-variants {
    margin-bottom: 24px;
  }

  .variant-option {
    margin-bottom: 20px;
  }

  .variant-label {
    display: block;
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    font-weight: 500;
    color: #888888;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 12px;
  }

  /* 尺码选择器 */
  .size-selector {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .size-button {
    position: relative;
    min-width: 60px;
    height: 44px;
    background: transparent;
    border: 1px solid #FFFFFF;
    color: #FFFFFF;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 500;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 0 16px;
  }

  .size-button:hover:not(:disabled) {
    background: #FFFFFF;
    color: #000000;
  }

  .size-button.selected {
    background: #FFFFFF;
    color: #000000;
  }

  .size-button.sold-out {
    opacity: 0.3;
    cursor: not-allowed;
    border-color: #888888;
    color: #888888;
  }

  .sold-out-badge {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 8px;
    white-space: nowrap;
  }

  /* 尺码表链接 */
  .size-guide-link {
    display: block;
    background: none;
    border: none;
    color: #888888;
    font-family: 'Inter', sans-serif;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    cursor: pointer;
    padding: 12px 0 0;
    text-decoration: underline;
    transition: color 0.3s ease;
  }

  .size-guide-link:hover {
    color: #FFFFFF;
  }

  /* 下拉选择器 */
  .variant-select {
    width: 100%;
    height: 44px;
    background: transparent;
    border: 1px solid #FFFFFF;
    color: #FFFFFF;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    padding: 0 16px;
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12' fill='none' stroke='white' stroke-width='1.5'%3E%3Cpath d='M3 5l3 3 3-3'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
  }

  .variant-select:focus {
    outline: none;
  }

  /* Notify Me */
  .notify-me-wrapper {
    margin-bottom: 24px;
  }

  .notify-me-wrapper.hidden,
  .product-actions.hidden {
    display: none;
  }

  .notify-me-text {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #888888;
    margin: 0 0 16px;
  }

  .notify-me-form {
    display: flex;
    gap: 8px;
  }

  .notify-me-input {
    flex: 1;
    height: 44px;
    background: transparent;
    border: 1px solid #FFFFFF;
    color: #FFFFFF;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    padding: 0 16px;
  }

  .notify-me-input::placeholder {
    color: #888888;
  }

  .notify-me-input:focus {
    outline: none;
  }

  .notify-me-button {
    height: 44px;
    background: #FFFFFF;
    border: none;
    color: #000000;
    font-family: 'Inter', sans-serif;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    padding: 0 24px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .notify-me-button:hover {
    background: #888888;
    color: #FFFFFF;
  }

  /* 数量选择器 */
  .quantity-selector {
    display: flex;
    align-items: center;
    border: 1px solid #FFFFFF;
    margin-bottom: 16px;
    width: fit-content;
  }

  .quantity-button {
    width: 44px;
    height: 44px;
    background: transparent;
    border: none;
    color: #FFFFFF;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s ease;
  }

  .quantity-button:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  .quantity-input {
    width: 50px;
    height: 44px;
    background: transparent;
    border: none;
    color: #FFFFFF;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    text-align: center;
    -moz-appearance: textfield;
  }

  .quantity-input::-webkit-outer-spin-button,
  .quantity-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .quantity-input:focus {
    outline: none;
  }

  /* 加购按钮 */
  .add-to-cart-button {
    width: 100%;
    height: 56px;
    background: #FFFFFF;
    border: 1px solid #FFFFFF;
    color: #000000;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .add-to-cart-button:hover:not(:disabled) {
    background: transparent;
    color: #FFFFFF;
  }

  .add-to-cart-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .button-loader.hidden {
    display: none;
  }

  .spinner {
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
</style>

{% schema %}
{
  "name": "Product Info",
  "tag": "section",
  "class": "section-product-info",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_sticky_info",
      "label": "启用粘性产品信息",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_zoom",
      "label": "启用图片放大",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_size_guide",
      "label": "显示尺码表",
      "default": true
    }
  ]
}
{% endschema %}
